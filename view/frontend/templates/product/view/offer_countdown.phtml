<?php
$blockObj= $block->getLayout()->createBlock('Flavour\FusionShipping\Block\View');
$visible = $blockObj->canShowBlock();

$dpd_cutoff = $blockObj->getDpdCutOff();
$royalmail_cutoff = $blockObj->getRoyalMailCutOff();

?>

<style>
    .bold-time {
        font-weight:800;
    }
</style>

<script>

    require([ 'jquery', 'jquery/ui'], function($){ $(document).ready(function($) {

        Date.prototype.addHours = function (h) {
            this.setHours(this.getHours() + h);
            return this;
        };

        var now = new Date();
        var royalmail = new Date(
            now.getFullYear(),
            now.getMonth(),
            now.getDate(),
            15,
            30,
            0,
            0
        );
        var dpd = new Date(
            now.getFullYear(),
            now.getMonth(),
            now.getDate(),
            18,
            30,
            0,
            0
        );

        var php_royalmail = "<?php echo $royalmail_cutoff; ?>";
        var php_dpd = "<?php echo $dpd_cutoff; ?>";

        var carrier1 = "Royal Mail";
        var carrier2 = "DPD";

        if (carrier1 === "Royal Mail") {

            var rm_cutoff = new Date(2032, 5, 21, 15, 30, 0, 0);
            var tmr = window.setInterval(function () {
                var d = new Date();
                var dif = rm_cutoff - d;
                var s = parseInt(dif / 1000);
                if (s < 0) {
                    document.getElementById('custom_royalmail').innerHTML = 'Event starts';
                    window.clearInterval(tmr);
                    return;
                }
                var sec = s % 60;
                var m = parseInt(s / 60);
                var min = m % 60;
                var h = parseInt(m / 60);
                var hour = h % 24;
                d = parseInt(h / 24);

                document.getElementById('custom_royalmail').innerHTML = hour + ':' + min + ':' + sec + ' Remains to place your ' + carrier1 + ' Order!';
            }, 1000);


        }

        if (carrier2 === "DPD") {

            var dpd_cutoff = new Date(2032, 5, 21, 18, 30, 0, 0);
            var tmr = window.setInterval(function () {
                var d = new Date();
                var dif = dpd_cutoff - d;
                var s = parseInt(dif / 1000);
                if (s < 0) {
                    document.getElementById('custom_dpd').innerHTML = 'Event starts';
                    window.clearInterval(tmr);
                    return;
                }
                var sec = s % 60;
                var m = parseInt(s / 60);
                var min = m % 60;
                var h = parseInt(m / 60);
                var hour = h % 24;
                d = parseInt(h / 24);

                document.getElementById('custom_dpd').innerHTML = hour + ':' + min + ':' + sec + ' Remains to place your ' + carrier2 + ' Order!';
            }, 1000);
        }

    });
});
</script>

<h5 class="timer-text">Order Now for Next day Delivery!</h5>

<?php if ($visible) { ?>
    <div>
        <p id="custom_royalmail" class="bold-time"></p>
        <p id="custom_dpd" class="bold-time"></p>


    </div>
<?php } else { ?>
    <?= "i'm not visible"; ?>
    <p>Custom Delivery Information unavailable</p>
<?php } ?>